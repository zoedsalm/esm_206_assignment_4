---
title: "esm_206_assignment_4"
author: "Zoe Duerksen-Salm & Audrey Nolan"
date: "11/6/2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r}
# Attach libraries

library(tidyverse)
library(tidyr)
library(janitor)
library(here)
library(plotly)
library(DT)
library(lubridate)
library(ggridges)
```

```{r}
#Read in lobster file + make it tidy

lobster_raw <- read_csv("lobster_abundance_sbc_lter.csv", na = "-99999")

lobster_tidy <- lobster_raw %>% 
  clean_names() %>%
  tidyr::uncount(count) %>% 
  select(year:size_mm)
```

Potential Histogram
```{r}
lobster_abund <- lobster_tidy

# Change site variable names from abreviations to full spelling
lobster_abund$site <- gsub("IVEE", "Isla Vista", lobster_abund$site)
lobster_abund$site <- gsub("NAPL", "Naples", lobster_abund$site)
lobster_abund$site <- gsub("AQUE", "Arroyo Quemado", lobster_abund$site)
lobster_abund$site <- gsub("CARP", "Carpinteria", lobster_abund$site)
lobster_abund$site <- gsub("MOHK", "Mohawk", lobster_abund$site)

# Make a graph
site_abundance_graph <- ggplot(lobster_abund, aes(x = year)) +
  geom_histogram(data = transform(lobster_abund, site = NULL), binwidth = 1, fill = "gray90") + 
  geom_histogram(binwidth = 1,
                 aes(fill = site),
                 show.legend = FALSE) +
  facet_wrap(~site)+
  theme_light()+
  labs(x = "Year",
       y = "Lobster Count",
       title = "Lobster Abundance Across Five Sites(Duerksen-Salm & Nolan)", 
       subtitle = "Abundance across five studied site compared to total total lobsters counted across all sites")
## I dont like this caption but we need to talk about what the shaded area means
(site_abundance_graph)

```


Results B.

Visually explore lobster size distribution shifts
Compare lobster sizes in 2012 and 2018

```{r}
lobster_12_18 <- lobster_tidy %>% 
  filter(year %in% c(2012, 2018))
```

Visually explore the size distributions for lobsters observed at the 5 different sites in 2012, and in 2018
(i.e. you will have a total of 10 size distributions shown: for each of the 5 sites, one for 2012 and one for 2018).
```{r}
lobster_size <- lobster_12_18 %>% 
  select(year, site, size_mm)

# Change site variable names from abreviations to full spelling
lobster_size$site <- gsub("IVEE", "Isla Vista", lobster_size$site)
lobster_size$site <- gsub("NAPL", "Naples", lobster_size$site)
lobster_size$site <- gsub("AQUE", "Arroyo Quemado", lobster_size$site)
lobster_size$site <- gsub("CARP", "Carpinteria", lobster_size$site)
lobster_size$site <- gsub("MOHK", "Mohawk", lobster_size$site)
```


```{r}

ggplot(lobster_size, aes(x = size_mm, y = site)) +
  geom_density_ridges(aes(fill = site),
                      show.legend = FALSE)+
  facet_wrap(~year) +
  scale_x_continuous(limits = c(30, 135),
                     expand = c(0,0)) +
  theme_light()+
  labs(x = "Lobster Size (mm)",
       y = "Site",
       title = "Change in lobster size by site")
# Change in distribution of lobster size
# Change in lobster size by site

```

Make a finalized graph showing community size distributions at each site in the 2 years, allowing the reader to easily interpret distribution shifts. Add a figure caption below the graph. 


---

Things that really didn't work but might be useful later...

```{r}
ggplot(lobster_size, aes(x = size_mm)) +
  geom_histogram(aes(fill = year,
                 show.legend = FALSE)) +
  facet_wrap(~site)+
  facet_wrap(~year)+
  labs(title = "Temperature Histogram", 
       y = "Lobster Count", 
       x = "Lobster Size (mm)") +
  theme_light()
```

```{r}
lobster_count <- lobster_raw %>% 
  clean_names() %>%
  group_by(year)

lobster_3a <- lobster_tidy %>% 
  select(date, site) %>% 
  group_by(site) %>% 
  count(date)

ggplot(lobster_3a, aes(x = date, y = n))+
  geom_line()+
  facet_wrap(~site)
```

## Results C. Compare mean lobster sizes at MPA vs. non-MPA sites in 2012 and 2018 
- MPAs: IV and Naples (establish 2012)